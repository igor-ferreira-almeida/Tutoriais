{"version":3,"sources":["../../app-es6/controllers/NegociacaoController.js"],"names":["ListaNegociacoes","Mensagem","Negociacao","NegociacaoView","MensagemView","NegociacaoService","DateHelper","Bind","NegociacaoController","$","document","querySelector","bind","_form","_inputData","_inputQuantidade","_inputValor","_service","_ordemAtual","_listaNegociacoes","_mensagem","_init","listar","then","negociacoes","forEach","adiciona","negociacao","catch","texto","erro","setInterval","importar","event","preventDefault","_criaNegociacao","cadastrar","mensagem","_limpaFormulario","apaga","esvazia","coluna","inverteOrdem","ordena","a","b","textoParaData","value","parseInt","parseFloat","reset","focus","negociacaoController","currentInstance"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import {ListaNegociacoes} from \"../models/ListaNegociacoes\";\r\nimport {Mensagem} from \"../models/Mensagem\";\r\nimport {Negociacao} from \"../models/Negociacao\";\r\n\r\nimport {NegociacaoView} from \"../views/NegociacaoView\";\r\nimport {MensagemView} from \"../views/MensagemView\";\r\n\r\nimport {NegociacaoService} from \"../services/NegociacaoService\";\r\n\r\nimport {DateHelper} from \"../helpers/DateHelper\";\r\nimport {Bind} from \"../helpers/Bind\";\r\n\r\nclass NegociacaoController {\r\n\r\n  constructor() {\r\n    let $ = document.querySelector.bind(document);\r\n\r\n    this._form = $(\".form\");\r\n    this._inputData = $(\"#data\");\r\n    this._inputQuantidade = $(\"#quantidade\");\r\n    this._inputValor = $(\"#valor\");\r\n    this._service = new NegociacaoService();\r\n\r\n    this._ordemAtual = '';\r\n\r\n    this._listaNegociacoes = new Bind(\r\n      new ListaNegociacoes(),\r\n      new NegociacaoView($(\"#negociacoesView\")),\r\n      'adiciona', 'esvazia', 'ordena', 'inverteOrdem'\r\n    );\r\n\r\n    this._mensagem = new Bind(new Mensagem(), new MensagemView($(\"#mensagemView\")), 'texto');\r\n    this._init();\r\n  }\r\n\r\n  _init() {\r\n    this._service.listar().then(negociacoes => {\r\n      negociacoes.forEach(negociacao => {\r\n        this._listaNegociacoes.adiciona(negociacao);\r\n      });\r\n    }).catch(erro => this._mensagem.texto = erro);\r\n\r\n    setInterval(() => this.importar(), 3000);\r\n  }\r\n\r\n  importar() {\r\n    this._service.importar(this._listaNegociacoes.negociacoes)\r\n      .then(negociacoes => {\r\n        negociacoes.forEach(negociacao => this._listaNegociacoes.adiciona(negociacao));\r\n        this._mensagem.texto = \"Negociações importadas com sucesso\";\r\n      }).catch(erro => this._mensagem.texto = erro);\r\n  }\r\n\r\n  adiciona(event) {\r\n    event.preventDefault();\r\n    let negociacao = this._criaNegociacao();\r\n    \r\n    this._service.cadastrar(negociacao).then(mensagem => {\r\n      this._listaNegociacoes.adiciona(negociacao);\r\n      this._mensagem.texto = mensagem;\r\n      this._limpaFormulario();\r\n    }).catch(erro => this._mensagem.texto = erro);\r\n  }\r\n\r\n  apaga() {\r\n    this._service.apaga().then(mensagem => {\r\n      this._mensagem.texto = mensagem;\r\n      this._listaNegociacoes.esvazia();\r\n    }).catch(erro => this._mensagem.texto = erro);\r\n  }\r\n\r\n  ordena(coluna) {\r\n    if (this._ordemAtual == coluna) {\r\n      this._listaNegociacoes.inverteOrdem();\r\n    } else {\r\n      this._listaNegociacoes.ordena((a, b) => a[coluna] - b[coluna]);\r\n    }\r\n    this._ordemAtual = coluna;\r\n  }\r\n\r\n  _criaNegociacao() {\r\n    return new Negociacao(\r\n      DateHelper.textoParaData(this._inputData.value),\r\n      parseInt(this._inputQuantidade.value),\r\n      parseFloat(this._inputValor.value)\r\n    );\r\n  }\r\n\r\n  _limpaFormulario() {\r\n    this._form.reset();\r\n    this._inputData.focus();\r\n  }\r\n}\r\n\r\nlet negociacaoController = new NegociacaoController();\r\n\r\nexport function currentInstance() {\r\n  return negociacaoController;\r\n}"]}